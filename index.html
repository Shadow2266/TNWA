<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‡ºç£é†«é™¢è­·ç†å¸«å·¥ä½œæ»¿æ„åº¦èª¿æŸ¥</title>
    
    <!-- 1. å¼•å…¥ Tailwind CSS (æ¨£å¼åº«) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. è¨­å®š Import Map (è®“ç€è¦½å™¨çŸ¥é“å»å“ªè£¡ä¸‹è¼‰ React å’Œåœ–ç¤ºåº«) -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.294.0"
        }
    }
    </script>

    <!-- 3. å¼•å…¥ Babel (è®“ç€è¦½å™¨å¯ä»¥åŸ·è¡Œ React/JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* è‡ªå®šç¾©æ²è»¸æ¨£å¼ */
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #10b981; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #059669; }
        
        /* å‹•ç•«è¨­å®š */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn { animation: fadeIn 0.5s ease-out forwards; }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        .animate-bounce { animation: bounce 1s infinite; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    </style>
</head>
<body class="bg-emerald-50 text-gray-800">
    <div id="root"></div>

    <!-- 4. ä¸»è¦ç¨‹å¼ç¢¼ -->
    <script type="text/babel" data-type="module">
        import React, { useState, useCallback } from 'react';
        import { createRoot } from 'react-dom/client';
        import { ClipboardCheck, Heart, User, ArrowRight, ArrowLeft, AlertTriangle, CheckCircle, Lock, FileText, CheckSquare, XCircle, Sparkles, Coffee, HelpCircle, RefreshCw, MousePointerClick, Mail, Phone } from 'lucide-react';

        // --- è¨­å®šå¾Œç«¯ API ç¶²å€ ---
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwSW54OZlDBTj2LiF0i03s3laPU0dWvcdLicQWtKHeDw15TbOCRrUcWc6V2-HOnP7S0/exec";

        // --- éœæ…‹è³‡æ–™ ---
        const satisfactionOptions = [
            { value: 5, label: "éå¸¸æ»¿æ„" }, { value: 4, label: "æ»¿æ„" }, { value: 3, label: "æ™®é€š" },
            { value: 2, label: "ä¸æ»¿æ„" }, { value: 1, label: "éå¸¸ä¸æ»¿æ„" }
        ];

        const satisfactionOptionsWithUnknown = [
            { value: 5, label: "éå¸¸æ»¿æ„" }, { value: 4, label: "æ»¿æ„" }, { value: 3, label: "æ™®é€š" },
            { value: 2, label: "ä¸æ»¿æ„" }, { value: 1, label: "éå¸¸ä¸æ»¿æ„" }, { value: 0, label: "ä¸æ¸…æ¥š" }
        ];

        const frequencyOptions = [
            { value: 1, label: "å¾æœª" }, { value: 2, label: "å¾ˆå°‘" }, { value: 3, label: "æœ‰æ™‚" },
            { value: 4, label: "ç¶“å¸¸" }, { value: 5, label: "ç¸½æ˜¯" }
        ];

        const stepsConfig = [
            { id: 'step-consent', title: 'å¡«å¯«èªªæ˜èˆ‡åŒæ„æ›¸', type: 'consent' }, // 0
            { id: 'step-1', title: 'ç¬¬ä¸€éƒ¨åˆ†ï¼šè­·ç†è·å ´æ»¿æ„ç¨‹åº¦', type: 'questions' }, // 1
            { id: 'step-2', title: 'ç¬¬ä¸€éƒ¨åˆ†(çºŒ)ï¼šå½ˆæ€§è­·ç†äººåŠ›è³‡æºç®¡ç†', type: 'questions' }, // 2
            { id: 'step-3', title: 'ç¬¬äºŒéƒ¨åˆ†ï¼šå·¥ä½œæ»¿æ„åº¦', type: 'questions' }, // 3
            { id: 'step-4', title: 'ç¬¬äºŒéƒ¨åˆ†(çºŒ)ï¼šç•™ä»»æ„é¡˜', type: 'questions' }, // 4
            { id: 'step-5', title: 'åŸºæœ¬è³‡æ–™', type: 'basic' }, // 5
            { id: 'step-finish', title: 'é ˜å–å›é¥‹èˆ‡å®Œæˆ', type: 'finish' } // 6
        ];

        const workplaceSections = [
            {
                title: "1. å®‰å…¨åŸ·æ¥­ç’°å¢ƒ",
                questions: [
                    { id: "q1-1", text: "å…·å®‰å…¨åŸ·æ¥­ç’°å¢ƒè¨­ç½®æ¨™æº–åŠç¶­è­·æ¨™æº–ï¼Œä¸¦è½å¯¦åŸ·è¡ŒåŠæŒçºŒæ”¹å–„ã€‚" },
                    { id: "q1-2", text: "æœ‰è¶³å¤ çš„ç¶“è²»ç¢ºä¿å®‰å…¨åŸ·æ¥­ç’°å¢ƒï¼Œä¸¦è½å¯¦åŸ·è¡Œã€‚" },
                    { id: "q1-3", text: "å…·å“¡å·¥å¥åº·æª¢æŸ¥åˆ¶åº¦ï¼Œä¸¦è½å¯¦å¾ŒçºŒè¿½è¹¤åŠç®¡ç†ã€‚" },
                    { id: "q1-4", text: "å…·è·æ¥­å‚·ç—…é é˜²ã€è™•ç½®åŠé€šå ±æ©Ÿåˆ¶ï¼Œä¸¦è½å¯¦æª¢è¨æ”¹å–„ã€‚" },
                    { id: "q1-5", text: "å…·è·æ¥­ç½å®³è£œå„Ÿæ©Ÿåˆ¶ï¼Œä¸¦è½å¯¦åŸ·è¡Œã€‚" },
                    { id: "q1-6", text: "è½å¯¦æ„Ÿæ§å‹•ç·šè¦åŠƒåŠé¢¨éšªå€åŸŸç®¡åˆ¶ã€‚" },
                    { id: "q1-7", text: "å…·é™ä½ç”Ÿç‰©æ€§å±å®³(å¦‚ï¼šé«”æ¶²ã€è¡€æ¶²èˆ‡å‚³æŸ“æ€§é†«ç™‚å»¢æ£„ç‰©ç­‰)çš„é˜²è­·è¨­å‚™åŠæªæ–½ã€‚" },
                    { id: "q1-8", text: "å…·é™ä½ç‰©ç†æ€§å±å®³(å¦‚ï¼šé›»å™¨ã€æ»…èŒé‹ã€æ°§æ°£æ§½ã€è¼»å°„ã€æº«åº¦ã€å™ªéŸ³ç­‰)çš„é˜²è­·è¨­å‚™åŠæªæ–½ã€‚" },
                    { id: "q1-9", text: "å…·é™ä½åŒ–å­¸æ€§å±å®³(å¦‚ï¼šé«˜å±è—¥ã€æœ‰æ©Ÿç‰©è³ªç­‰)çš„é˜²è­·è¨­å‚™åŠæªæ–½ã€‚" },
                    { id: "q1-10", text: "ç¢ºå¯¦åŸ·è¡ŒåŸ·æ¥­ç’°å¢ƒå±å®³è©•ä¼°èˆ‡æ”¹å–„ã€‚" },
                    { id: "q1-11", text: "å…·ç¬¦åˆäººå› å·¥ç¨‹çš„åŸºæœ¬è¨­æ–½(å¦‚ï¼šæ¡Œæ¤…ã€å·¥ä½œå°ã€å·¥ä½œè»Šã€ç‡ˆå…‰ã€ç©ºé–“ç­‰)ã€‚" },
                    { id: "q1-12", text: "å…·é é˜²äººå› å·¥ç¨‹å±å®³ä¹‹è¨­å‚™(å¦‚ï¼šç§»ä½æ»‘æ¿ã€é›»å‹•åºŠã€é›»å‹•ç£…ç§¤åºŠç­‰)ã€‚" },
                    { id: "q1-13", text: "è½å¯¦äººå› å·¥ç¨‹å±å®³çš„é é˜²èˆ‡ç®¡ç†ã€‚" },
                    { id: "q1-14", text: "è¨‚æœ‰è·å ´æš´åŠ›(å¦‚ï¼šéœ¸å‡Œã€æ€§ä¾µå®³ç­‰)èˆ‡æ€§é¨·æ“¾å±å®³é˜²æ²»æ”¿ç­–åŠæ¨™æº–ä½œæ¥­æµç¨‹ã€‚" },
                    { id: "q1-15", text: "å…·è·å ´æš´åŠ›(å¦‚ï¼šéœ¸å‡Œã€æ€§ä¾µå®³ç­‰)èˆ‡æ€§é¨·æ“¾é€šå ±æ©Ÿåˆ¶ä¸¦å”è™•åˆå®œã€‚" },
                    { id: "q1-16", text: "æä¾›è·å ´æš´åŠ›(å¦‚ï¼šéœ¸å‡Œã€æ€§ä¾µå®³ç­‰)èˆ‡æ€§é¨·æ“¾å—å®³å“¡å·¥çš„æ”¯æ´èˆ‡è¼”å°ã€‚" },
                ]
            },
            {
                title: "2. äººåŠ›ç´ è³ª",
                questions: [
                    { id: "q2-1", text: "å…·è­·ç†å¸«è­‰ç…§ä½”ç‡ã€‚" },
                    { id: "q2-2", text: "å…·N2(å«)ä»¥ä¸Šä½”ç‡ã€‚" },
                    { id: "q2-3", text: "å…·æœ¬é™¢è‡¨åºŠå·¥ä½œå¹´è³‡2å¹´(å«)ä»¥ä¸Šä½”ç‡ã€‚" },
                    { id: "q2-4", text: "å…·ç¢©å£«å­¸ä½ä¹‹è­·ç†é•·(å«)ä»¥ä¸Šä¸»ç®¡ä½”ç‡ã€‚" },
                ]
            },
            {
                title: "3. å·¥ä½œè² è·èˆ‡è–ªè³‡ç¦åˆ©",
                questions: [
                    { id: "q3-1", text: "åˆå®œçš„ä¸‰ç­è­·ç—…æ¯”(ä¸€èˆ¬æ€¥æ€§ç—…æˆ¿)ã€‚" },
                    { id: "q3-2", text: "æœ‰æ©Ÿå‹•è­·ç†äººåŠ›èª¿é…æ©Ÿåˆ¶ã€‚" },
                    { id: "q3-3", text: "æœ‰è¼”åŠ©äººåŠ›ï¼Œç¶­æŒåˆç†å·¥ä½œè² è·ã€‚" },
                    { id: "q3-4", text: "å…·å¸‚å ´è¡Œæƒ…çš„è–ªè³‡(å«ç¸¾æ•ˆçé‡‘)ã€‚" },
                    { id: "q3-5", text: "å…·å¸‚å ´è¡Œæƒ…çš„å¤œç­è²»ã€‚" },
                    { id: "q3-6", text: "å…·è­·ç†å°ˆæ¥­é€²éšæˆ–å‡ç­‰åˆ¶åº¦ï¼Œä¸¦éš¨èƒ½åŠ›é€²éšæˆ–å‡ç­‰è·ç´šèª¿æ•´è–ªè³‡/çé‡‘ã€‚" },
                    { id: "q3-7", text: "å…·å¤šå…ƒæ¿€å‹µæªæ–½,å®šæœŸè©•ä¼°æ¿€å‹µåˆ¶åº¦ï¼ŒåŠ ä»¥æ”¹é€²å’Œæä¾›åˆé©èˆ‡å³æ™‚æ€§é…¬è³ã€‚" },
                    { id: "q3-8", text: "å…·å„ªæ¸¥çš„ç¦åˆ©æ–¹æ¡ˆ(å¦‚ï¼šä¿éšªã€å‚·æ®˜ã€æˆ¿ç§Ÿã€æ•™è‚²ã€æˆ¿è²¸ã€åˆ¶æœã€æ´—è¡£ã€ä¼™é£Ÿã€äº¤é€šã€æ€¥é›£æ•‘åŠ©ã€è‚²å¬°ã€æ‰˜å…’ã€æ‰˜è€ç­‰)ã€‚" },
                ]
            },
            {
                title: "4. å°ˆæ¥­åˆ†å·¥èˆ‡åœ˜éšŠåˆä½œ",
                questions: [
                    { id: "q4-1", text: "è­·ç†éƒ¨é–€å°å°ˆæ¥­åˆ†å·¥ä¹‹æ±ºç­–å…·æœ‰å½±éŸ¿åŠ›ã€‚" },
                    { id: "q4-2", text: "åœ˜éšŠå°ˆæ¥­åˆ†å·¥æ˜ç¢ºä¸”ç¢ºå¯¦åŸ·è¡Œã€‚" },
                    { id: "q4-3", text: "éè­·ç†å°ˆæ¥­å·¥ä½œç”±å°ˆè²¬å–®ä½è² è²¬ç›£ç£èˆ‡ç®¡ç†ã€‚" },
                    { id: "q4-4", text: "è·¨é ˜åŸŸåœ˜éšŠå…·ç›¸äº’å°Šé‡çš„æ–‡åŒ–ã€‚" },
                    { id: "q4-5", text: "è·¨é ˜åŸŸåœ˜éšŠå…·è‰¯å¥½çš„æºé€šåŠåˆä½œæ©Ÿåˆ¶ã€‚" },
                    { id: "q4-6", text: "è­·ç†åœ˜éšŠå–®ä½å…§èˆ‡å–®ä½é–“æœ‰äº’åŠ©åˆä½œæ©Ÿåˆ¶ã€‚" },
                ]
            },
            {
                title: "5. å·¥ä½œç°¡åŒ–",
                questions: [
                    { id: "q5-1", text: "è­·ç†ä¸»ç®¡ç©æ¥µæ¨å‹•å·¥ä½œç°¡åŒ–ã€‚" },
                    { id: "q5-2", text: "è­·ç†äººå“¡è½å¯¦åŸ·è¡Œå·¥ä½œç°¡åŒ–ã€‚" },
                    { id: "q5-3", text: "å·¥ä½œç°¡åŒ–æœ‰å…·é«”æˆæ•ˆè©•å€¼ã€‚" },
                    { id: "q5-4", text: "é¼“å‹µåƒèˆ‡å·¥ä½œç°¡åŒ–ï¼Œä¸¦æœ‰çå‹µæªæ–½ã€‚" },
                    { id: "q5-5", text: "å·¥ä½œç°¡åŒ–èƒ½ç²å¾—è·¨é ˜åŸŸåœ˜éšŠçš„æ”¯æŒèˆ‡å”åŠ©ã€‚" },
                ]
            },
            {
                title: "6. è³‡è¨ŠåŒ–",
                questions: [
                    { id: "q6-1", text: "ç—…æˆ¿å…·è¶³å¤ çš„è³‡è¨Šç§‘æŠ€ç¡¬é«”è¨­å‚™(å¦‚ï¼šEåŒ–è­·ç†å·¥ä½œè»Šã€åºŠé‚Šé›»è…¦ç­‰)ã€‚" },
                    { id: "q6-2", text: "å…·é©ç•¶çš„ç—…äººå®‰å…¨ç¶­è­·ç³»çµ±ã€‚" },
                    { id: "q6-3", text: "å…·ç¬¦åˆè­·ç†äººå“¡éœ€æ±‚çš„è‡¨åºŠè­·ç†è³‡è¨Šç³»çµ±ã€‚" },
                    { id: "q6-4", text: "å…·æ•¸ä½åŒ–å­¸ç¿’åŠç®¡ç†ç³»çµ±ã€‚" },
                    { id: "q6-5", text: "å…·é©ç•¶ä¹‹è­·ç†è³‡è¨Šç®¡ç†åŠŸèƒ½ã€‚" },
                ]
            },
            {
                title: "7. äººæ‰åŸ¹è‚²èˆ‡å°ˆæ¥­ç™¼å±•",
                questions: [
                    { id: "q7-1", text: "è­·ç†éƒ¨é–€å°äººæ‰åŸ¹è‚²æœ‰å…·é«”ä¹‹æ–¹å‘åŠç­–ç•¥ã€‚" },
                    { id: "q7-2", text: "é†«é™¢æä¾›å……è¶³è³‡æºï¼Œé€²è¡Œè­·ç†äººæ‰åŸ¹è‚²ï¼Œä¸¦æœ‰å…·é«”æˆæ•ˆã€‚" },
                    { id: "q7-3", text: "å…·è‡¨åºŠå°ˆæ¥­èƒ½åŠ›é€²éšåˆ¶åº¦ï¼Œä»¥åŠä¿ƒé€²å°ˆæ¥­èƒ½åŠ›æ©Ÿåˆ¶ï¼Œä¸¦å®šæœŸæª¢è¦–èˆ‡è©•å€¼ã€‚" },
                    { id: "q7-4", text: "å”åŠ©åŠæ¿€å‹µè­·ç†äººå“¡å°ˆæ¥­è·æ¶¯è¦åŠƒï¼Œä¸¦æœ‰å…·é«”æˆæœã€‚" },
                    { id: "q7-5", text: "å±•ç¾å¤šå…ƒåŒ–è­·ç†å°ˆæ¥­è§’è‰²èˆ‡åŠŸèƒ½(å¦‚ï¼šå€‹ç®¡å¸«ã€å®‰å¯§å…±ç…§å¸«ã€è³‡è¨Šè­·ç†å¸«ç­‰)ã€‚" },
                    { id: "q7-6", text: "å…·é«”å‘ˆç¾è­·ç†å¯¦å‹™ä¹‹å°ˆæ¥­ç™¼å±•èˆ‡å‰µæ–°å¯¦ä¾‹ã€‚" },
                    { id: "q7-7", text: "ç—…äººåŠå®¶å±¬è‚¯å®šè­·ç†å°ˆæ¥­çš„åƒ¹å€¼ã€‚" },
                    { id: "q7-8", text: "é†«ç™‚åœ˜éšŠåŠé™¢å…§åŒä»è‚¯å®šè­·ç†äººå“¡å°ˆæ¥­è²¢ç»ã€‚" },
                    { id: "q7-9", text: "è­·ç†å°ˆæ¥­ç™¼å±•èƒ½èˆ‡åœ‹éš›æ¥è»Œï¼Œä¸¦æœ‰å…·é«”ç­–ç•¥ã€‚" },
                ]
            },
            {
                title: "8. æ”¯æŒèˆ‡é—œæ‡·",
                questions: [
                    { id: "q8-1", text: "é†«é™¢å…§é‡å¤§æœƒè­°å‡æœ‰è­·ç†éƒ¨ä¸»ç®¡åƒèˆ‡(å¦‚ï¼šé ç®—ã€ç¸¾æ•ˆã€çæ‡²ã€äººåŠ›è³‡æºã€å“è³ªç®¡ç†ç­‰æœƒè­°)ã€‚" },
                    { id: "q8-2", text: "é‡å¤§æ±ºç­–æ¡ç´è­·ç†éƒ¨ä¸»ç®¡æ„è¦‹ã€‚" },
                    { id: "q8-3", text: "æ”¯æŒè­·ç†éƒ¨é–€ä¸¦æä¾›æ‰€éœ€è³‡æºã€‚" },
                    { id: "q8-4", text: "å°Šé‡è­·ç†éƒ¨é–€ä¹‹äººäº‹æ±ºç­–ã€‚" },
                    { id: "q8-5", text: "å®šæœŸèˆ‡ä¸å®šæœŸçå‹µè­·ç†äººå“¡è‰¯å¥½çš„å·¥ä½œè¡¨ç¾ï¼Œä¸¦å…¬é–‹è¡¨æšã€‚" },
                    { id: "q8-6", text: "æœ‰å°ˆè²¬å–®ä½æ”¯æŒåŠå”åŠ©è­·ç†äººå“¡è™•ç†å„ç¨®å›°å¢ƒ(å¦‚ï¼šç•°å¸¸äº‹ä»¶ã€å®¢è¨´ã€é†«ç™‚çˆ­è­°ç­‰)ã€‚" },
                    { id: "q8-7", text: "è­·ç†éƒ¨é–€ä¹‹æœƒè­°åŠæ”¿ç­–åˆ¶å®šæœ‰åŸºå±¤è­·ç†äººå“¡åƒèˆ‡ã€‚" },
                    { id: "q8-8", text: "è­·ç†äººå“¡æœ‰å¤šå…ƒç®¡é“è¡¨é”æ„è¦‹ï¼Œä¸¦ç²å¾—æœ‰æ•ˆè™•ç†ã€‚" },
                    { id: "q8-9", text: "å…·æœ‰å½ˆæ€§çš„æ’ç­åŸå‰‡ï¼Œç¬¦åˆå¤šå…ƒéœ€æ±‚ã€‚" },
                    { id: "q8-10", text: "é—œæ‡·è­·ç†äººå“¡ä¹‹å·¥ä½œå’Œç”Ÿæ´»éœ€æ±‚ã€‚" },
                    { id: "q8-11", text: "æä¾›è­·ç†äººå“¡èº«å¿ƒç´“å£“çš„æ”¯æŒåœ˜é«”æˆ–ç›¸é—œæ´»å‹•èˆ‡æªæ–½ã€‚" },
                ]
            },
            {
                title: "9. æ•´é«”æ»¿æ„åº¦",
                questions: [
                    { id: "q1-overall", text: "æ•´é«”è€Œè¨€ï¼Œæ‚¨å°ç›®å‰è­·ç†è·å ´ç’°å¢ƒçš„æ»¿æ„åº¦ã€‚" }
                ]
            }
        ];

        const flexibleManpowerQuestions = [
            { id: "fm-1", title: "è·èƒ½å½ˆæ€§", text: "æ‚¨å°é†«é™¢åˆ©ç”¨è·èƒ½è®ŠåŒ–ï¼Œè³¦äºˆäººåŠ›é‹ç”¨çš„å½ˆæ€§ï¼ˆå¦‚ï¼šæ•™è‚²è¨“ç·´ã€äº¤å‰è¨“ç·´ã€å·¥ä½œè¼ªèª¿ã€è‡ªä¸»æ€§ç­‰ï¼‰çš„æ»¿æ„æƒ…å½¢ã€‚" },
            { id: "fm-2", title: "æ•¸é‡å½ˆæ€§", text: "æ‚¨å°é†«é™¢åœ¨é¢å°ç…§è­·éœ€æ±‚è®Šå‹•æ™‚ï¼Œèƒ½åŠæ™‚èª¿æ•´äººåŠ›æ•¸é‡ï¼ˆå¦‚ï¼šæµ®å‹•äººåŠ›åº«ã€å·¥ä½œåˆ†äº«åˆ¶ç­‰ï¼‰çš„æ»¿æ„æƒ…å½¢ã€‚" },
            { id: "fm-3", title: "å€éš”å½ˆæ€§", text: "æ‚¨å°é†«é™¢é…ç½®æ ¸å¿ƒè­·ç†äººåŠ›ï¼Œä¸¦é©åº¦è˜ç”¨å‘¨é‚ŠäººåŠ›ï¼ˆå¦‚ï¼šè­·ä½ï¼‰ä¸”çµ¦äºˆåˆé©è·ç¨±è–ªé…¬çš„æ»¿æ„æƒ…å½¢ã€‚" },
            { id: "fm-4", title: "æ™‚é–“å½ˆæ€§", text: "æ‚¨å°é†«é™¢åˆ©ç”¨æ”¹è®Šå·¥ä½œæ™‚æ•¸æˆ–æ™‚æ®µï¼ˆå¦‚ï¼šæ’ç­è€ƒé‡åå¥½ã€å½ˆæ€§æ’ç­ã€å›ºå®šç­åˆ¥ã€éƒ¨åˆ†å·¥æ™‚ï¼‰çš„æ»¿æ„æƒ…å½¢ã€‚" },
            { id: "fm-5", title: "è–ªè³‡å½ˆæ€§", text: "æ‚¨å°é†«é™¢æ¡ç”¨å€‹äººåŒ–ã€å¤šæ¨£æ€§åŠæ¿€å‹µæ€§è–ªçµ¦åˆ¶åº¦ï¼ˆå¦‚ï¼šç¸¾æ•ˆçé‡‘ã€åˆ©æ½¤åˆ†äº«ï¼‰çš„æ»¿æ„æƒ…å½¢ã€‚" },
            { id: "fm-6", title: "é ˜å°å½ˆæ€§", text: "æ‚¨å°é†«é™¢ä¿ƒé€²åœ˜éšŠåˆä½œã€æºé€šã€æˆæ¬ŠåŠç‡Ÿé€ è‰¯å¥½æ°£æ°›çš„æ»¿æ„æƒ…å½¢ã€‚" },
            { id: "fm-overall", title: "æ•´é«”", text: "æ•´é«”è€Œè¨€ï¼Œæ‚¨å°ç›®å‰å½ˆæ€§è­·ç†äººåŠ›è³‡æºç®¡ç†çš„æ»¿æ„åº¦ã€‚" },
        ];

        const jobSatisfactionQuestions = [
            "æˆ‘å°æ–¼æ©Ÿæ§‹æä¾›çš„å€‹äººé˜²è­·è¨­æ–½åŠé…å‚™æ„Ÿåˆ°", "æˆ‘å°æ–¼å„é …ä½œæ¥­çš„è³‡è¨ŠåŒ–æ„Ÿåˆ°", "æˆ‘å°æ–¼å·¥ä½œç’°å¢ƒçš„å®‰å…¨æ€§æ„Ÿåˆ°", "æˆ‘å°æ–¼æ©Ÿæ§‹æä¾›é†«ç™‚è¨­å‚™çš„å“é …åŠæ•¸é‡æ„Ÿåˆ°", "æˆ‘å°æ–¼æ©Ÿæ§‹æä¾›ç—…äººçš„ç…§è­·æ¨¡å¼æ„Ÿåˆ°",
            "æˆ‘å°æ–¼æ©Ÿæ§‹æ”¯æŒè­·ç†äººå“¡é€²ä¿®æ„Ÿåˆ°", "æˆ‘å°æ–¼æ©Ÿæ§‹æä¾›çš„å°ˆæ¥­è¨“ç·´æ„Ÿåˆ°", "æˆ‘å°æ–¼æœå‹™æ©Ÿæ§‹çš„é€€ä¼‘åˆ¶åº¦æ„Ÿåˆ°", "æˆ‘å°æ–¼è·ä½çš„å‡é·æ©Ÿæœƒæ„Ÿåˆ°", "æˆ‘å°æ–¼ç¾æœ‰çš„è–ªè³‡å ±é…¬æ„Ÿåˆ°",
            "æˆ‘å°æ–¼èƒ½è‡ªæˆ‘æŒæ¡å·¥ä½œçš„ç‹€æ³æ„Ÿåˆ°", "æˆ‘å°æ–¼è‡ªå·±è™•ç†å±æ©Ÿçš„èƒ½åŠ›æ„Ÿåˆ°", "æˆ‘å°æ–¼å·¥ä½œçš„å°ˆæ¥­è‡ªä¸»æ„Ÿåˆ°", "æˆ‘å°æ–¼è‡ªå·±æœ‰åƒèˆ‡å„é …é‡è¦æ±ºç­–çš„æ©Ÿæœƒæ„Ÿåˆ°", "æˆ‘å°æ–¼è‡ªå·±çš„å·¥ä½œèƒ½åŠ›èƒ½ç²å¾—åŒå„•çš„èªåŒèˆ‡è‚¯å®šæ„Ÿåˆ°",
            "æˆ‘å°æ–¼è‡ªå·±çš„å·¥ä½œèƒ½åŠ›èƒ½ç²å¾—ä¸»ç®¡çš„èªåŒèˆ‡è‚¯å®šæ„Ÿåˆ°", "æˆ‘å°æ–¼èƒ½å¾å·¥ä½œä¸Šç²å¾—æˆå°±æ„Ÿæ„Ÿåˆ°", "æˆ‘å°æ–¼åœ¨å·¥ä½œä¸Šèƒ½å¾—åˆ°å­¸ç¿’çš„æ©Ÿæœƒæ„Ÿåˆ°", "æˆ‘å°æ–¼èˆ‡å…¶ä»–é†«äº‹äººå“¡çš„äº’å‹•æƒ…å½¢æ„Ÿåˆ°", "æˆ‘å°æ–¼èˆ‡é†«å¸«å…±åŒåˆä½œæƒ…å½¢æ„Ÿåˆ°",
            "æˆ‘å°æ–¼èˆ‡è­·ç†äººå“¡å…±åŒåˆä½œæƒ…å½¢æ„Ÿåˆ°", "æˆ‘å°æ–¼èˆ‡è¡Œæ”¿äººå“¡çš„äº’å‹•æƒ…å½¢æ„Ÿåˆ°", "æˆ‘å°æ–¼æˆ‘çš„å·¥ä½œå—åˆ°è·¨åœ˜éšŠæˆå“¡çš„ç›¸äº’å°Šé‡æ„Ÿåˆ°", "æˆ‘å°æ–¼èˆ‡è­·ç†åŒå„•çš„äº’å‹•æƒ…å½¢æ„Ÿåˆ°", "æˆ‘å°æ–¼ç›´å±¬è­·ç†ä¸»ç®¡çš„æ”¯æŒèˆ‡é—œæ‡·æ„Ÿåˆ°",
            "æˆ‘å°æ–¼ç›´å±¬è­·ç†ä¸»ç®¡çš„é ˜å°èƒ½åŠ›æ„Ÿåˆ°", "æˆ‘å°æ–¼ç›´å±¬è­·ç†ä¸»ç®¡æœ‰èƒ½åŠ›å‡èšåœ˜éšŠå‘å¿ƒåŠ›æ„Ÿåˆ°", "æˆ‘å°æ–¼ç›´å±¬è­·ç†ä¸»ç®¡èƒ½å…¬å¹³èˆ‡åˆç†çš„å°å¾…æ„Ÿåˆ°ï¼ˆå¦‚ï¼šå‡é·ã€è€ƒæ ¸ç­‰ï¼‰", "æˆ‘å°æ–¼ç›®å‰éè­·ç†å°ˆæ¥­çš„å·¥ä½œé‡æ„Ÿåˆ°", "æˆ‘å°æ–¼ç›®å‰è­·ç†å°ˆæ¥­çš„å·¥ä½œé‡æ„Ÿåˆ°",
            "æˆ‘å°æ–¼è‡ªå·±æ‰¿æ“”ç›®å‰è­·ç†å·¥ä½œçš„å›°é›£åº¦æ„Ÿåˆ°", "æ•´é«”ä¾†èªªï¼Œæˆ‘å°æ–¼ç›®å‰å·¥ä½œçš„æ»¿æ„åº¦æ„Ÿåˆ°"
        ];

        const retentionQuestions = [
            { id: "ret-1", text: "æˆ‘è€ƒæ…®è¦è¾­å»ç›®å‰çš„å·¥ä½œ" },
            { id: "ret-2", text: "æˆ‘æ¢è½å…¶ä»–éè­·ç†çš„å·¥ä½œæ©Ÿæœƒ" },
            { id: "ret-3", text: "æˆ‘æ¢è½å…¶ä»–é†«é™¢çš„è­·ç†å·¥ä½œæ©Ÿæœƒ" },
            { id: "ret-4", text: "æˆ‘å°ç›®å‰çš„è­·ç†å·¥ä½œæ„Ÿåˆ°æ»¿æ„ï¼Œä¸¦é¡˜æ„ç¹¼çºŒå¾äº‹æ­¤é …æ¥­å‹™" },
            { id: "ret-5", text: "æˆ‘é¡˜æ„ç¹¼çºŒå¾äº‹ç›®å‰å°ˆæ¥­é ˜åŸŸçš„è­·ç†å·¥ä½œ" }
        ];

        const EncouragementBanner = React.memo(({ title, message, icon: Icon = Sparkles }) => (
            <div className="my-10 p-6 bg-gradient-to-r from-yellow-50 to-orange-50 rounded-2xl border border-yellow-200 flex flex-col md:flex-row items-center md:items-start shadow-sm animate-fadeIn">
                <div className="bg-white p-3 rounded-full shadow-sm mb-3 md:mb-0 md:mr-5 shrink-0">
                    <Icon className="w-8 h-8 text-yellow-500" />
                </div>
                <div className="text-center md:text-left">
                    <h4 className="text-xl font-bold text-yellow-800 mb-2">{title}</h4>
                    <p className="text-yellow-700 leading-relaxed font-medium">{message}</p>
                </div>
            </div>
        ));

        const QuestionItem = React.memo(({ 
            id, 
            text, 
            subTitle, 
            options, 
            showReasonInput = true, 
            numberPrefix, 
            currentScore, 
            reasonValue, 
            onScoreChange, 
            onReasonChange 
        }) => {
            const isDissatisfied = showReasonInput && currentScore && currentScore <= 2 && currentScore !== 0;
            const charCount = reasonValue ? reasonValue.length : 0;
            const maxChars = 200;

            return (
                <div id={id} className={`mb-6 p-6 bg-white rounded-xl shadow-sm border ${currentScore === undefined ? 'border-red-200 bg-red-50/30' : 'border-emerald-100'} scroll-mt-32`}>
                    {subTitle && <h4 className="text-emerald-700 font-bold mb-2 text-lg">{subTitle}</h4>}
                    <div className="flex items-start mb-4">
                        {numberPrefix && <span className="bg-emerald-100 text-emerald-800 text-sm font-bold px-2 py-1 rounded mr-2 mt-1 shrink-0">{numberPrefix}</span>}
                        <p className="text-gray-800 font-medium text-lg leading-relaxed">
                            {text} <span className="text-red-500">*</span>
                        </p>
                    </div>
                    
                    <div className="flex flex-col md:flex-row gap-2 md:gap-4 w-full flex-wrap"> 
                        {options.map((opt) => (
                            <label key={opt.value} className="flex-1 relative cursor-pointer group min-w-[80px]">
                                <input
                                    type="radio"
                                    name={id} 
                                    value={opt.value}
                                    checked={currentScore === opt.value}
                                    onChange={(e) => onScoreChange(id, parseInt(e.target.value))}
                                    className="peer sr-only"
                                />
                                <div className={`
                                    p-3 text-center rounded-lg border-2 transition-all
                                    flex flex-col items-center justify-center h-full
                                    peer-checked:bg-emerald-600 peer-checked:text-white peer-checked:border-emerald-600
                                    hover:bg-emerald-50 hover:border-emerald-300 border-gray-200 text-gray-600
                                `}>
                                    <span className="text-xl font-bold">{opt.value}</span>
                                    <span className="text-xs">{opt.label}</span>
                                </div>
                            </label>
                        ))}
                    </div>

                    {isDissatisfied && (
                        <div className="mt-4 animate-fadeIn relative">
                            <label className="block text-sm font-bold text-red-600 mb-2 flex items-center">
                                <AlertTriangle className="w-4 h-4 mr-1" />
                                è«‹ç°¡è¿°ä¸æ»¿æ„åŸå›  (å¿…å¡«ï¼Œæœ€å¤š200å­—)ï¼š
                            </label>
                            <textarea
                                className={`w-full p-3 border-2 rounded-lg focus:ring-2 focus:ring-emerald-500 outline-none resize-y min-h-[100px] ${!reasonValue ? 'border-red-400 bg-red-50' : 'border-emerald-200'}`}
                                rows="3"
                                maxLength={maxChars}
                                value={reasonValue || ''}
                                onChange={(e) => onReasonChange(id, e.target.value)}
                            />
                            <div className={`absolute bottom-3 right-3 text-xs font-medium pointer-events-none transition-colors
                                ${charCount > maxChars * 0.9 ? 'text-red-500' : 'text-gray-400'}
                            `}>
                                {charCount} / {maxChars}
                            </div>
                        </div>
                    )}
                </div>
            );
        }, (prevProps, nextProps) => {
            return (
                prevProps.currentScore === nextProps.currentScore &&
                prevProps.reasonValue === nextProps.reasonValue &&
                prevProps.id === nextProps.id
            );
        });

        // --- ä¸»å…ƒä»¶ ---

        const SurveyForm = () => {
            const [currentStep, setCurrentStep] = useState(0); 
            const [consent, setConsent] = useState({ read: false, agree: false, understand: false });
            const [answers, setAnswers] = useState({});
            const [reasons, setReasons] = useState({});
            const [basicData, setBasicData] = useState({
                location: '', level: '', department: '', gender: '', birthYear: '',
                education: '', nLevel: '', totalTenure: '', currentTenure: '',
                marriage: '', religion: '', shiftType: ''
            });
            const [emails, setEmails] = useState({ primary: '', secondary: '' });
            const [showAbandonModal, setShowAbandonModal] = useState(false);
            const [isAbandoned, setIsAbandoned] = useState(false);
            const [isSubmitted, setIsSubmitted] = useState(false);
            const [isSubmitting, setIsSubmitting] = useState(false);

            const handleScoreChange = useCallback((questionId, value) => {
                setAnswers(prev => ({ ...prev, [questionId]: parseInt(value) }));
                if (parseInt(value) > 2 || parseInt(value) === 0) {
                    setReasons(prev => {
                        const newReasons = { ...prev };
                        delete newReasons[questionId];
                        return newReasons;
                    });
                }
            }, []);

            const handleReasonChange = useCallback((questionId, text) => {
                setReasons(prev => ({ ...prev, [questionId]: text }));
            }, []);

            const handleBasicDataChange = (field, value) => {
                setBasicData(prev => ({ ...prev, [field]: value }));
            };

            const handleEmailChange = (field, value) => {
                setEmails(prev => ({ ...prev, [field]: value }));
            };

            const handleConsentChange = (key) => {
                setConsent(prev => ({ ...prev, [key]: !prev[key] }));
            };

            const validateStep = () => {
                if (currentStep === 0) {
                    return consent.read && consent.agree && consent.understand ? null : 'step-consent';
                }
                
                let currentIds = [];
                if (currentStep === 1) {
                    workplaceSections.forEach(sec => sec.questions.forEach(q => currentIds.push(q.id)));
                } else if (currentStep === 2) {
                    flexibleManpowerQuestions.forEach(q => currentIds.push(q.id));
                } else if (currentStep === 3) {
                    jobSatisfactionQuestions.forEach((_, i) => currentIds.push(`js-${i+1}`));
                } else if (currentStep === 4) {
                    retentionQuestions.forEach(q => currentIds.push(q.id));
                }

                if (currentStep >= 1 && currentStep <= 4) {
                    for (let id of currentIds) {
                        const score = answers[id];
                        if (score === undefined) return id; 
                        if (currentStep !== 4 && score <= 2 && score !== 0 && (!reasons[id] || reasons[id].trim() === "")) return id; 
                    }
                }

                if (currentStep === 5) {
                    const basicKeys = Object.keys(basicData);
                    for (let key of basicKeys) {
                        if (!basicData[key]) return key; 
                    }
                }

                if (currentStep === 6) {
                    if (!emails.primary || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emails.primary)) return 'email-primary';
                    if (emails.secondary && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emails.secondary)) return 'email-secondary';
                }

                return null; 
            };

            const getMissingCount = () => {
                if (currentStep === 0) return (consent.read && consent.agree && consent.understand) ? 0 : 1;
                if (currentStep === 6) return (!emails.primary || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emails.primary)) ? 1 : 0;
                if (currentStep === 5) return Object.values(basicData).filter(v => !v).length;
                
                let currentIds = [];
                if (currentStep === 1) workplaceSections.forEach(sec => sec.questions.forEach(q => currentIds.push(q.id)));
                else if (currentStep === 2) flexibleManpowerQuestions.forEach(q => currentIds.push(q.id));
                else if (currentStep === 3) jobSatisfactionQuestions.forEach((_, i) => currentIds.push(`js-${i+1}`));
                else if (currentStep === 4) retentionQuestions.forEach(q => currentIds.push(q.id));

                return currentIds.filter(id => {
                    const score = answers[id];
                    if(score === undefined) return true;
                    if(currentStep !== 4 && score <= 2 && score !== 0 && (!reasons[id] || reasons[id].trim() === "")) return true;
                    return false;
                }).length;
            }

            // ä¿®æ­£: åœ¨å¤–éƒ¨è¨ˆç®— isStepValidï¼Œé¿å… ReferenceError
            const isStepValid = validateStep() === null;
            const missingCount = getMissingCount();

            const goNext = () => {
                const errorId = validateStep();
                if (!errorId) {
                    setCurrentStep(prev => prev + 1);
                    window.scrollTo(0, 0);
                } else {
                    if (currentStep >= 1 && currentStep !== 6) {
                        const element = document.getElementById(errorId);
                        if (element) {
                            element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            if (currentStep === 5) {
                                const input = element.querySelector('input, select');
                                if (input) input.focus();
                            }
                        }
                    } else if (currentStep === 6) {
                        const element = document.getElementById(errorId);
                        if(element) element.focus();
                        else alert("è«‹è¼¸å…¥æœ‰æ•ˆçš„å¸¸ç”¨ Emailï¼");
                    } else {
                        alert("è«‹å®Œæˆæ‰€æœ‰å¿…å¡«æ¬„ä½ï¼");
                    }
                }
            };

            const goBack = () => {
                if (currentStep > 0) {
                    setCurrentStep(prev => prev - 1);
                    window.scrollTo(0, 0);
                }
            };

            const handleAbandonClick = () => setShowAbandonModal(true);
            const handleContinueSurvey = () => setShowAbandonModal(false);
            const handleConfirmAbandon = () => {
                setShowAbandonModal(false);
                setIsAbandoned(true);
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                const errorId = validateStep();
                if (!errorId) {
                    setIsSubmitting(true);
                    
                    const formData = {
                        answers,
                        reasons,
                        basicData,
                        emails,
                        timestamp: new Date().toISOString()
                    };

                    try {
                        await fetch(GOOGLE_SCRIPT_URL, {
                            method: 'POST',
                            mode: 'no-cors',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(formData)
                        });
                        
                        setIsSubmitted(true);
                        window.scrollTo(0, 0);

                    } catch (error) {
                        console.error("Submission Error:", error);
                        alert("é€å‡ºå¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šå¾Œé‡è©¦ï¼Œæˆ–è¯ç¹«ç®¡ç†å“¡ã€‚");
                    } finally {
                        setIsSubmitting(false);
                    }
                } else {
                    if (currentStep === 6) {
                        const element = document.getElementById(errorId);
                        if(element) {
                            element.focus();
                            alert("è«‹è¼¸å…¥æœ‰æ•ˆçš„å¸¸ç”¨ Emailï¼");
                        }
                    }
                }
            };

            if (isSubmitted) {
                return (
                    <div className="bg-white p-10 rounded-3xl shadow-2xl text-center border-t-8 border-emerald-500 animate-fadeIn my-10 max-w-lg mx-auto">
                        <div className="w-24 h-24 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-6">
                            <CheckCircle className="w-12 h-12 text-emerald-600" />
                        </div>
                        <h2 className="text-3xl font-bold text-gray-800 mb-4">å•å·å·²æˆåŠŸé€å‡ºï¼</h2>
                        <p className="text-gray-600 mb-8 leading-relaxed text-lg">
                            æ„Ÿè¬æ‚¨çš„å¯¶è²´æ„è¦‹ã€‚<br/>
                            é›»å­ç¦®åˆ¸å°‡å¯„é€è‡³æ‚¨çš„ä¿¡ç®±ï¼š<br/>
                            <span className="font-bold text-emerald-600">{emails.primary}</span>
                        </p>
                        <button 
                            onClick={() => window.location.reload()} 
                            className="w-full py-3 bg-emerald-600 text-white rounded-xl font-bold hover:bg-emerald-700 transition-colors flex items-center justify-center"
                        >
                            <RefreshCw className="w-5 h-5 mr-2" /> é—œé–‰è¦–çª—
                        </button>
                    </div>
                );
            }

            // é é¢å…§å®¹æ¸²æŸ“é‚è¼¯
            let content = null;
            if (currentStep === 0) {
                 content = (
                    <div className="bg-white p-6 md:p-10 rounded-2xl shadow-lg border-t-8 border-emerald-600 animate-fadeIn mb-24">
                         <h2 className="text-2xl font-bold text-emerald-900 mb-6 flex items-center">
                            <FileText className="w-8 h-8 mr-3 text-emerald-600" />
                            è­·ç†å¸«å¡«å¯«èªªæ˜èˆ‡åŒæ„æ›¸
                        </h2>
                        <div className="prose prose-emerald text-gray-700 leading-relaxed mb-8 max-h-[60vh] overflow-y-auto pr-2 custom-scrollbar">
                            <p className="font-bold text-lg">è¦ªæ„›çš„è­·ç†åŒä»æ‚¨å¥½ï¼š</p>
                            <p>æ„Ÿè¬æ‚¨åœ¨ç¹å¿™çš„å·¥ä½œä¸­æ’¥ç©ºå”åŠ©æœ¬æ¬¡ç ”ç©¶ã€‚æœ¬å•å·æ—¨åœ¨äº†è§£å…¨åœ‹å„å±¤ç´šé†«é™¢è­·ç†å¸«çš„<span className="font-bold">è·å ´ç¾æ³ã€å·¥ä½œæ»¿æ„åº¦èˆ‡çµ„ç¹”æ–‡åŒ–æ°›åœ</span>ï¼Œä»¥åšç‚ºå¾ŒçºŒæå‡è­·ç†è·å ´ç’°å¢ƒèˆ‡æ”¿ç­–å€¡è­°çš„é‡è¦åƒè€ƒã€‚</p>
                            <p className="font-bold mt-4">åœ¨æ‚¨é–‹å§‹å¡«ç­”ä¹‹å‰ï¼Œè«‹è©³é–±ä»¥ä¸‹èªªæ˜ï¼š</p>
                            <p>æœ¬ç ”ç©¶ç”±ä¸­è¯æ°‘åœ‹è­·ç†å¸«è­·å£«å…¬æœƒå…¨åœ‹è¯åˆæœƒï¼ˆå…¨è¯æœƒï¼‰ä¾æœƒå“¡æ¯”ä¾‹åˆ†å±¤æŠ½æ¨£ï¼Œäº†è§£è­·ç†å¸«åœ¨ä¸åŒåœ°å€ï¼ˆåŒ—ã€ä¸­ã€å—ã€æ±ï¼‰åŠä¸åŒå±¤ç´šé†«é™¢ä¸­çš„å·¥ä½œç¶“é©—ã€è·å ´æ°›åœèˆ‡æ»¿æ„åº¦ï¼Œä»¥æ”¯æŒå¾ŒçºŒè­·ç†æ”¿ç­–èˆ‡è·å ´æ”¹å–„ã€‚</p>
                            <p className="mt-2">æœ¬å•å·åƒ…æä¾›ç¬¬ä¸€ç·šç›´æ¥ç…§è­·ç—…äººçš„è­·ç†å¸«å¡«å¯«ï¼Œå·²æ’é™¤ä¸»ç®¡ã€ç®¡ç†å¸«ã€å€‹æ¡ˆç®¡ç†å¸«èˆ‡éç›´æ¥ç…§è­·äººå“¡ã€‚ä»¥é›»å­å•å·æ–¹å¼é€²è¡Œï¼Œé è¨ˆéœ€èŠ±è²» 30â€“45 åˆ†é˜å®Œæˆã€‚æ‚¨çš„å¡«ç­”å¯å”åŠ©å…¨åœ‹è­·ç†å¸«å…±åŒç™¼è²ï¼Œä¿ƒé€²æ”¹å–„è·å ´æ–‡åŒ–èˆ‡ç…§è­·ç’°å¢ƒï¼Œä¸¦æä¾›æ”¿ç­–åˆ¶å®šè€…å¯é çš„å¯¦è­‰è³‡æ–™ã€‚ä¹Ÿè¨±åœ¨å¡«ç­”éç¨‹ä¸­ï¼Œå¯èƒ½å› å›é¡§è·å ´ç¶“é©—è€Œæ„Ÿåˆ°äº›è¨±æƒ…ç·’è² è·ï¼Œä½†æ•´é«”é¢¨éšªæ¥µä½ã€‚</p>
                            <h3 className="text-lg font-bold text-emerald-800 mt-6 mb-2">è³‡æ–™ä¿å¯†èˆ‡ä½¿ç”¨æ–¹å¼</h3>
                            <ul className="list-disc pl-5 space-y-2">
                                <li>æœ¬å•å·æ¡å®Œå…¨åŒ¿åæ–¹å¼ï¼Œå•å·ä¸æœƒè¨˜éŒ„æ‚¨çš„å§“åã€å“¡ç·¨ã€IP ä½å€æˆ–ä»»ä½•è¶³ä»¥è­˜åˆ¥æ‚¨çš„è³‡è¨Šã€‚</li>
                                <li>æ‰€æœ‰è³‡æ–™åƒ…ä½œç ”ç©¶èˆ‡çµ±è¨ˆåˆ†æä¹‹ç”¨ã€‚</li>
                                <li>ç ”ç©¶çµæœå°‡ä»¥æ•´é«”æˆ–ç¾¤çµ„æ–¹å¼å‘ˆç¾ï¼Œä¸æœƒæ­éœ²ä»»ä½•å€‹äººè³‡è¨Šã€‚</li>
                            </ul>
                            <h3 className="text-lg font-bold text-emerald-800 mt-6 mb-2">åƒèˆ‡çš„è‡ªç”±èˆ‡æ¬Šç›Š</h3>
                            <p>æ‚¨çš„åƒèˆ‡å®Œå…¨è‡ªé¡˜ï¼Œå¯åœ¨ä»»ä½•æ™‚é–“é¸æ“‡ä¸åƒèˆ‡æˆ–ä¸­æ­¢ä½œç­”ï¼Œä¸¦ä¸æœƒå½±éŸ¿æ‚¨çš„å·¥ä½œæ¬Šç›Šã€‚</p>
                            <div className="bg-orange-50 border-l-4 border-orange-400 p-4 mt-6">
                                <p className="text-orange-800 font-bold">
                                    ç‚ºæ„Ÿè¬æ‚¨å°è­·ç†å°ˆæ¥­èˆ‡ç’°å¢ƒæ”¹å–„çš„æ”¯æŒï¼Œ å®Œæˆå•å·å¾Œè«‹ç•™ä¸‹æ‚¨çš„é›»å­ä¿¡ç®±(è«‹ç•™å€‹äººä¿¡ç®±,éæ©Ÿæ§‹) ï¼Œæˆ‘å€‘å°‡è‡´è´ˆé›»å­ç¦®åˆ¸ï¼ŒèŠè¡¨æ•¬æ„ã€‚
                                </p>
                            </div>
                        </div>
                        <div className="bg-gray-50 p-6 rounded-xl border border-gray-200">
                            <p className="font-bold text-gray-800 mb-4 text-lg border-b pb-2">åœ¨é–‹å§‹ä½œç­”å‰ï¼Œè«‹æ‚¨é–±è®€ä¸¦ç¢ºèªä»¥ä¸‹å…§å®¹ï¼š</p>
                            <div className="space-y-4">
                                <label className="flex items-center space-x-3 cursor-pointer p-2 hover:bg-white rounded transition-colors">
                                    <div className={`w-6 h-6 rounded border-2 flex items-center justify-center transition-colors ${consent.read ? 'bg-emerald-600 border-emerald-600' : 'border-gray-300 bg-white'}`}>
                                        {consent.read && <CheckSquare className="w-4 h-4 text-white" />}
                                    </div>
                                    <input type="checkbox" className="hidden" checked={consent.read} onChange={() => handleConsentChange('read')} />
                                    <span className="text-gray-700">æˆ‘å·²é–±è®€ä¸¦äº†è§£ä¸Šè¿°èªªæ˜ã€‚</span>
                                </label>
                                <label className="flex items-center space-x-3 cursor-pointer p-2 hover:bg-white rounded transition-colors">
                                    <div className={`w-6 h-6 rounded border-2 flex items-center justify-center transition-colors ${consent.agree ? 'bg-emerald-600 border-emerald-600' : 'border-gray-300 bg-white'}`}>
                                        {consent.agree && <CheckSquare className="w-4 h-4 text-white" />}
                                    </div>
                                    <input type="checkbox" className="hidden" checked={consent.agree} onChange={() => handleConsentChange('agree')} />
                                    <span className="text-gray-700">æˆ‘åŒæ„åƒåŠ æ­¤ç ”ç©¶ä¸¦å¡«å¯«æœ¬å•å·ã€‚</span>
                                </label>
                                <label className="flex items-center space-x-3 cursor-pointer p-2 hover:bg-white rounded transition-colors">
                                    <div className={`w-6 h-6 rounded border-2 flex items-center justify-center transition-colors ${consent.understand ? 'bg-emerald-600 border-emerald-600' : 'border-gray-300 bg-white'}`}>
                                        {consent.understand && <CheckSquare className="w-4 h-4 text-white" />}
                                    </div>
                                    <input type="checkbox" className="hidden" checked={consent.understand} onChange={() => handleConsentChange('understand')} />
                                    <span className="text-gray-700">æˆ‘äº†è§£æœ¬å•å·åŒ¿åã€è³‡æ–™åƒ…ä¾›ç ”ç©¶ä½¿ç”¨ï¼Œä¸”æˆ‘å¯éš¨æ™‚åœæ­¢ä½œç­”ã€‚</span>
                                </label>
                            </div>
                        </div>
                        <div className="mt-8 text-sm text-gray-500 border-t pt-4">
                             <p className="font-bold text-emerald-700 mb-2">è‹¥æ‚¨åŒæ„ï¼Œè«‹é»é¸ã€Œé–‹å§‹ä½œç­”ã€é€²å…¥å•å·ã€‚</p>
                            <p>è‹¥æ‚¨å°æœ¬ç ”ç©¶æœ‰ä»»ä½•ç–‘å•ï¼Œå¯èˆ‡ç ”ç©¶åœ˜éšŠè¯ç¹«ï¼š</p>
                            <p>ä¸­è¯æ°‘åœ‹è­·ç†å¸«è­·å£«å…¬æœƒå…¨åœ‹è¯åˆæœƒ â€” è·å ´ç ”ç©¶å°çµ„</p>
                            <p>é›»è©±ï¼š(02)2550-2283 #14 | E-mailï¼šlan@nurse.org.tw</p>
                        </div>
                        <div className="mt-8">
                            <button 
                                onClick={goNext}
                                disabled={!isStepValid} 
                                className={`
                                w-full py-4 rounded-xl font-bold text-xl flex items-center justify-center transition-all shadow-lg transform
                                ${(consent.read && consent.agree && consent.understand)
                                    ? 'bg-gradient-to-r from-emerald-600 to-teal-600 text-white hover:from-emerald-700 hover:to-teal-700 hover:scale-[1.02] shadow-emerald-500/30 ring-2 ring-emerald-400/50' 
                                    : 'bg-gray-300 text-gray-500 cursor-not-allowed'}
                                `}
                            >
                                é–‹å§‹ä½œç­” <ArrowRight className="ml-3 w-6 h-6" />
                            </button>
                        </div>
                    </div>
                );
            } else if (currentStep === 1) {
                content = (
                    <div className="space-y-8 animate-fadeIn mb-24">
                        {workplaceSections.map((section, idx) => (
                            <React.Fragment key={`section-${idx}`}>
                                <div className="bg-white/60 rounded-xl p-2 md:p-4">
                                    <h3 className="text-xl font-bold text-emerald-800 mb-4 px-3 border-l-4 border-emerald-500">{section.title}</h3>
                                    {section.questions.map(q => {
                                        const isSpecialQuestion = ['q2-1', 'q2-2', 'q2-3', 'q2-4'].includes(q.id);
                                        const options = isSpecialQuestion ? satisfactionOptionsWithUnknown : satisfactionOptions;
                                        return (
                                            <QuestionItem 
                                                key={q.id} id={q.id} text={q.text} options={options} numberPrefix={q.id.replace('q', '')}
                                                currentScore={answers[q.id]} reasonValue={reasons[q.id]}
                                                onScoreChange={handleScoreChange} onReasonChange={handleReasonChange}
                                            />
                                        );
                                    })}
                                </div>
                                {idx === 2 && (
                                    <EncouragementBanner
                                        key="encourage-banner-3"
                                        title="æ·±å‘¼å¸ï¼Œä¼‘æ¯ä¸€ä¸‹ ğŸŒ¿"
                                        message="é€™ä¸€éƒ¨åˆ†çš„é¡Œé …è¼ƒå¤šï¼Œè¾›è‹¦æ‚¨äº†ï¼å›é¡§ã€Œå·¥ä½œè² è·ã€èˆ‡ã€Œè–ªè³‡ã€å¯èƒ½éœ€è¦ä¸€é»å¿ƒåŠ›ï¼Œè«‹å–å£æ°´å–˜å£æ°£ï¼Œæ‚¨çš„çœŸå¯¦å›é¥‹æ˜¯æˆ‘å€‘çˆ­å–æ¬Šç›Šçš„é‡è¦ä¾æ“šã€‚"
                                        icon={Coffee}
                                    />
                                )}
                            </React.Fragment>
                        ))}
                    </div>
                );
            } else if (currentStep === 2) {
                content = (
                    <div className="space-y-8 animate-fadeIn mb-24">
                        {flexibleManpowerQuestions.map((q, index) => (
                            <QuestionItem 
                                key={q.id} id={q.id} subTitle={q.title} text={q.text} 
                                options={satisfactionOptions} numberPrefix={`${index + 1}`}
                                currentScore={answers[q.id]} reasonValue={reasons[q.id]}
                                onScoreChange={handleScoreChange} onReasonChange={handleReasonChange}
                            />
                        ))}
                    </div>
                );
            } else if (currentStep === 3) {
                content = (
                    <div className="space-y-8 animate-fadeIn mb-24">
                        {jobSatisfactionQuestions.map((text, index) => (
                            <React.Fragment key={`js-frag-${index}`}>
                                <QuestionItem 
                                    key={`js-${index+1}`} id={`js-${index+1}`} text={text} 
                                    options={satisfactionOptions} numberPrefix={`${index + 1}`}
                                    currentScore={answers[`js-${index+1}`]} reasonValue={reasons[`js-${index+1}`]}
                                    onScoreChange={handleScoreChange} onReasonChange={handleReasonChange}
                                />
                                {index === 14 && (
                                    <EncouragementBanner 
                                        key="encourage-banner"
                                        title="æ„Ÿè¬æ‚¨çš„å …æŒï¼ğŸ‘"
                                        message="é€™éƒ¨åˆ†çš„é¡Œç›®è¼ƒå¤šï¼Œæ‚¨è¾›è‹¦äº†ï¼å†å …æŒä¸€ä¸‹ï¼Œæˆ‘å€‘éå¸¸é‡è¦–æ‚¨å°å·¥ä½œå„é¢å‘çš„çœŸå¯¦æ„Ÿå—ï¼Œé€™å°‡æˆç‚ºæ¨å‹•è®Šé©çš„é‡è¦ä¾æ“šã€‚"
                                        icon={Sparkles}
                                    />
                                )}
                            </React.Fragment>
                        ))}
                    </div>
                );
            } else if (currentStep === 4) {
                content = (
                    <div className="space-y-8 animate-fadeIn mb-24">
                        {retentionQuestions.map((q, index) => (
                            <QuestionItem 
                                key={q.id} id={q.id} text={q.text} 
                                options={frequencyOptions} showReasonInput={false} numberPrefix={`${index + 1}`}
                                currentScore={answers[q.id]} reasonValue={reasons[q.id]}
                                onScoreChange={handleScoreChange} onReasonChange={handleReasonChange}
                            />
                        ))}
                    </div>
                );
            } else if (currentStep === 5) {
                content = (
                    <div className="bg-white rounded-2xl shadow-md overflow-hidden animate-fadeIn mb-24">
                        <div className="bg-emerald-700 p-4 flex items-center text-white">
                            <User className="w-6 h-6 mr-2" />
                            <h3 className="text-xl font-bold">åŸºæœ¬è³‡æ–™ (å…¨å¿…å¡«)</h3>
                        </div>
                        <div className="p-6 md:p-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                             <div id="location" className="col-span-1 md:col-span-2 scroll-mt-32">
                                <label className="block font-bold mb-2 text-gray-700">æ©Ÿæ§‹ç¸£å¸‚ <span className="text-red-500">*</span></label>
                                <select className="w-full p-3 border rounded-lg" value={basicData.location} onChange={e=>handleBasicDataChange('location', e.target.value)}>
                                <option value="">è«‹é¸æ“‡</option>
                                {['åŸºéš†å¸‚','æ–°åŒ—å¸‚','å°åŒ—å¸‚','æ¡ƒåœ’å¸‚','æ–°ç«¹ç¸£å¸‚','è‹—æ —ç¸£','å°ä¸­å¸‚','å½°åŒ–ç¸£','å—æŠ•ç¸£','å˜‰ç¾©ç¸£å¸‚','é›²æ—ç¸£','å°å—å¸‚','é«˜é›„å¸‚','å±æ±ç¸£å¸‚','å®œè˜­ç¸£å¸‚','èŠ±è“®ç¸£å¸‚','å°æ±ç¸£å¸‚','é‡‘é–€ç¸£','æ¾æ¹–ç¸£'].map(c=><option key={c}>{c}</option>)}
                                </select>
                            </div>
                            <div id="level" className="scroll-mt-32"><label className="block font-bold mb-2">æ©Ÿæ§‹å±¤ç´š <span className="text-red-500">*</span></label>
                                <select className="w-full p-3 border rounded-lg" value={basicData.level} onChange={e=>handleBasicDataChange('level', e.target.value)}>
                                <option value="">è«‹é¸æ“‡</option><option>é†«å­¸ä¸­å¿ƒ</option><option>å€åŸŸé†«é™¢</option><option>åœ°å€é†«é™¢</option><option>ç²¾ç¥å°ˆç§‘é†«é™¢</option>
                                </select>
                            </div>
                            <div id="department" className="scroll-mt-32"><label className="block font-bold mb-2">å·¥ä½œç§‘åˆ¥ <span className="text-red-500">*</span></label>
                                <select className="w-full p-3 border rounded-lg" value={basicData.department} onChange={e=>handleBasicDataChange('department', e.target.value)}>
                                <option value="">è«‹é¸æ“‡</option><option>å…§å¤–ç§‘ç—…æˆ¿</option><option>æ€¥è¨º</option><option>å©¦ç”¢ç§‘</option><option>å…’ç§‘</option><option>åŠ è­·å–®ä½</option><option>é–€è¨º</option><option>æ‰‹è¡“å®¤</option><option>ç²¾ç¥ç§‘</option><option>å…¶ä»–</option>
                                </select>
                            </div>
                            <div id="gender" className="scroll-mt-32"><label className="block font-bold mb-2">æ€§åˆ¥ <span className="text-red-500">*</span></label>
                                <select className="w-full p-3 border rounded-lg" value={basicData.gender} onChange={e=>handleBasicDataChange('gender', e.target.value)}>
                                <option value="">è«‹é¸æ“‡</option><option>ç”Ÿç†ç”·</option><option>ç”Ÿç†å¥³</option><option>ä¸ä¾¿é€éœ²</option>
                                </select>
                            </div>
                            <div id="birthYear" className="scroll-mt-32"><label className="block font-bold mb-2">å‡ºç”Ÿæ°‘åœ‹å¹´ <span className="text-red-500">*</span></label>
                                <input type="number" className="w-full p-3 border rounded-lg" value={basicData.birthYear} onChange={e=>handleBasicDataChange('birthYear', e.target.value)} />
                            </div>
                            <div id="education" className="scroll-mt-32"><label className="block font-bold mb-2">æ•™è‚²ç¨‹åº¦ <span className="text-red-500">*</span></label>
                                <select className="w-full p-3 border rounded-lg" value={basicData.education} onChange={e=>handleBasicDataChange('education', e.target.value)}>
                                <option value="">è«‹é¸æ“‡</option><option>è·æ ¡</option><option>å°ˆç§‘</option><option>å¤§å­¸</option><option>ç ”ç©¶æ‰€ä»¥ä¸Š</option>
                                </select>
                            </div>
                            <div id="nLevel" className="scroll-mt-32"><label className="block font-bold mb-2">é€²éšå±¤ç´š <span className="text-red-500">*</span></label>
                                <select className="w-full p-3 border rounded-lg" value={basicData.nLevel} onChange={e=>handleBasicDataChange('nLevel', e.target.value)}>
                                <option value="">è«‹é¸æ“‡</option><option>N</option><option>N1</option><option>N2</option><option>N3</option><option>N4</option>
                                </select>
                            </div>
                            <div id="totalTenure" className="scroll-mt-32"><label className="block font-bold mb-2">è­·ç†ç¸½å¹´è³‡ <span className="text-red-500">*</span></label>
                                <input type="number" className="w-full p-3 border rounded-lg" value={basicData.totalTenure} onChange={e=>handleBasicDataChange('totalTenure', e.target.value)} />
                            </div>
                            <div id="currentTenure" className="scroll-mt-32"><label className="block font-bold mb-2">ç›®å‰æ©Ÿæ§‹å¹´è³‡ <span className="text-red-500">*</span></label>
                                <input type="number" className="w-full p-3 border rounded-lg" value={basicData.currentTenure} onChange={e=>handleBasicDataChange('currentTenure', e.target.value)} />
                            </div>
                            <div id="marriage" className="scroll-mt-32"><label className="block font-bold mb-2">å©šå§»ç‹€æ³ <span className="text-red-500">*</span></label>
                                <select className="w-full p-3 border rounded-lg" value={basicData.marriage} onChange={e=>handleBasicDataChange('marriage', e.target.value)}>
                                <option value="">è«‹é¸æ“‡</option><option>å–®èº«</option><option>å·²å©š</option><option>å…¶ä»–</option>
                                </select>
                            </div>
                            <div id="religion" className="scroll-mt-32"><label className="block font-bold mb-2">å®—æ•™ä¿¡ä»° <span className="text-red-500">*</span></label>
                                <select className="w-full p-3 border rounded-lg" value={basicData.religion} onChange={e=>handleBasicDataChange('religion', e.target.value)}>
                                <option value="">è«‹é¸æ“‡</option><option>ç„¡ä¿¡ä»°</option><option>ä½›æ•™</option><option>é“æ•™</option><option>åŸºç£æ•™</option><option>å¤©ä¸»æ•™</option><option>å…¶ä»–</option>
                                </select>
                            </div>
                            <div id="shiftType" className="col-span-1 md:col-span-2 scroll-mt-32">
                                <label className="block font-bold mb-2">ç­åˆ¥å‹æ…‹ <span className="text-red-500">*</span></label>
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-2">
                                {['å¹³å‡è¼ªå€¼ä¸‰ç­', 'ç™½ç­ç‚ºä¸»', 'å°å¤œç‚ºä¸»', 'å¤§å¤œç‚ºä¸»'].map(opt => (
                                    <label key={opt} className={`cursor-pointer px-3 py-2 rounded-lg border text-center ${basicData.shiftType === opt ? 'bg-emerald-600 text-white' : 'bg-white'}`}>
                                    <input type="radio" className="hidden" checked={basicData.shiftType === opt} onChange={()=>handleBasicDataChange('shiftType', opt)} />
                                    {opt}
                                    </label>
                                ))}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            } else if (currentStep === 6) {
                content = (
                    <div className="bg-white rounded-2xl shadow-md overflow-hidden animate-fadeIn mb-24">
                        <div className="bg-gradient-to-r from-orange-500 to-red-500 p-6 text-white text-center">
                            <h3 className="text-2xl font-bold mb-2">ğŸ‰ æ„Ÿè¬æ‚¨å°æœ¬ç ”ç©¶çš„æ”¯æŒ</h3>
                            <p className="opacity-90">æˆ‘å€‘å°‡å¯„é€é›»å­ç¦®åˆ¸èŠè¡¨æ„Ÿè¬ä¹‹æ„</p>
                        </div>
                        <div className="p-8 md:p-12 space-y-8">
                            <div className="bg-orange-50 p-4 rounded-xl border border-orange-200 text-orange-800 text-sm leading-relaxed">
                                <p className="font-bold mb-1">âš ï¸ é‡è¦æé†’ï¼š</p>
                                <p>è«‹è¼¸å…¥æ‚¨ <span className="font-bold underline">å€‹äººä¿¡ç®±</span>ï¼Œé¿å…ä½¿ç”¨æ©Ÿæ§‹ä¿¡ç®±ä¸¦ç•™æ„æˆ‘å€‘å¯„é€çš„é›»å­ç¦®å·ã€‚</p>
                            </div>
                            <div className="space-y-6">
                                <div id="email-primary">
                                    <label className="block text-lg font-bold text-gray-700 mb-2 flex items-center">
                                        <Mail className="w-5 h-5 mr-2 text-emerald-600" />
                                        å¸¸ç”¨ E-mail (å¿…å¡«) <span className="text-red-500 ml-1">*</span>
                                    </label>
                                    <input 
                                        type="email" 
                                        placeholder="example@gmail.com" 
                                        className="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-emerald-500 focus:ring-4 focus:ring-emerald-100 outline-none text-lg"
                                        value={emails.primary}
                                        onChange={(e) => handleEmailChange('primary', e.target.value)}
                                    />
                                </div>
                                <div id="email-secondary">
                                    <label className="block text-lg font-bold text-gray-700 mb-2 flex items-center">
                                        <Mail className="w-5 h-5 mr-2 text-gray-400" />
                                        å‚™ç”¨ E-mail
                                    </label>
                                    <input 
                                        type="email" 
                                        placeholder="optional@email.com" 
                                        className="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-gray-400 focus:ring-4 focus:ring-gray-100 outline-none text-lg"
                                        value={emails.secondary}
                                        onChange={(e) => handleEmailChange('secondary', e.target.value)}
                                    />
                                </div>
                            </div>
                            <div className="border-t pt-6 mt-8">
                                <h4 className="font-bold text-gray-700 mb-4 flex items-center">
                                    <Phone className="w-5 h-5 mr-2" />
                                    ç ”ç©¶å°çµ„è¯çµ¡è³‡è¨Š
                                </h4>
                                <div className="text-sm text-gray-500 space-y-1 pl-7">
                                    <p>ä¸­è¯æ°‘åœ‹è­·ç†å¸«è­·å£«å…¬æœƒå…¨åœ‹è¯åˆæœƒ â€” è·å ´ç ”ç©¶å°çµ„</p>
                                    <p>é›»è©±ï¼š(02)2550-2283 #14</p>
                                    <p>E-mailï¼šlan@nurse.org.tw</p>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            if (isAbandoned) {
                return (
                    <div className="min-h-screen bg-emerald-50 flex items-center justify-center p-4">
                        <div className="bg-white p-8 rounded-3xl shadow-2xl max-w-md w-full text-center border-t-8 border-yellow-400 animate-fadeIn">
                        <div className="w-24 h-24 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-6">
                            <Heart className="w-12 h-12 text-yellow-500 fill-current" />
                        </div>
                        <h2 className="text-2xl font-bold text-gray-800 mb-4">æ‚¨çš„æ„è¦‹çœŸçš„å¾ˆé‡è¦ï¼</h2>
                        <p className="text-gray-600 mb-8 leading-relaxed text-lg">
                            æœ‰ç©ºè¦å†å›ä¾†å¡«ç­”å–”ï¼<br/>
                            æˆ‘å€‘æœŸå¾…æ‚¨çš„å¯¶è²´å»ºè­°ã€‚
                        </p>
                        <button 
                            onClick={() => window.location.reload()} 
                            className="w-full py-3 bg-emerald-600 text-white rounded-xl font-bold hover:bg-emerald-700 transition-colors flex items-center justify-center"
                        >
                            <RefreshCw className="w-5 h-5 mr-2" /> å›åˆ°é¦–é 
                        </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-emerald-50 font-sans text-gray-800 pb-0">
                    <header className="bg-gradient-to-r from-emerald-800 to-teal-700 text-white shadow-lg sticky top-0 z-50">
                        <div className="max-w-4xl mx-auto px-4 py-4 flex items-center justify-between">
                        <div className="flex items-center space-x-3">
                            <div className="bg-white/20 p-2 rounded-lg"><ClipboardCheck className="w-6 h-6" /></div>
                            <div>
                            <h1 className="text-lg md:text-2xl font-bold">è‡ºç£é†«é™¢è­·ç†å¸«å·¥ä½œæ»¿æ„åº¦èª¿æŸ¥</h1>
                            <p className="text-xs opacity-80">Step {currentStep} / {stepsConfig.length - 1}</p>
                            </div>
                        </div>
                        </div>
                        <div className="h-2 bg-emerald-900/30 w-full">
                        <div className="h-full bg-yellow-400 transition-all duration-500" style={{ width: `${(currentStep / (stepsConfig.length - 1)) * 100}%` }}></div>
                        </div>
                    </header>

                    <main className="max-w-4xl mx-auto px-4 py-8">
                        {currentStep > 0 && currentStep < stepsConfig.length && (
                        <div className="mb-6 flex items-center justify-between">
                            <h2 className="text-2xl font-bold text-emerald-900">{stepsConfig[currentStep].title}</h2>
                        </div>
                        )}
                        {content}
                    </main>

                    {!isSubmitted && currentStep !== 0 && (
                        <footer className="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-md shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] border-t border-emerald-100 z-50 p-4">
                        <div className="max-w-4xl mx-auto flex items-center justify-between">
                            <button 
                            onClick={handleAbandonClick}
                            className="flex items-center px-4 py-3 text-red-500 font-bold hover:bg-red-50 rounded-xl transition-colors text-sm md:text-base"
                            >
                            <XCircle className="w-5 h-5 md:mr-2" />
                            <span className="hidden md:inline">æ”¾æ£„å¡«ç­”</span>
                            <span className="md:hidden">æ”¾æ£„</span>
                            </button>

                            <div className="flex space-x-3 items-center">
                                <div className="flex flex-col items-end">
                                    {(!isStepValid && !isSubmitting) && (
                                        <div className="hidden md:flex items-center text-orange-600 text-sm font-bold mb-1 animate-bounce w-full justify-end">
                                            ã€Œé»æˆ‘ã€è·³è‡³æœªå¡«é¡Œé …ï¼
                                        </div>
                                    )}
                                    <div className="flex space-x-3">
                                        {currentStep > 0 && (
                                            <button 
                                            onClick={goBack}
                                            className="flex items-center px-5 py-3 border-2 border-emerald-600 text-emerald-600 font-bold rounded-xl hover:bg-emerald-50 transition-all"
                                            >
                                            <ArrowLeft className="w-5 h-5 md:mr-2" />
                                            <span className="hidden md:inline">ä¸Šä¸€é </span>
                                            </button>
                                        )}

                                        <button 
                                            onClick={currentStep === 6 ? handleSubmit : goNext}
                                            className={`
                                            flex items-center px-6 py-3 rounded-xl font-bold text-white shadow-lg transition-all min-w-[140px] justify-center relative
                                            ${isStepValid 
                                                ? 'bg-emerald-600 hover:bg-emerald-700 hover:scale-105' 
                                                : 'bg-gray-400 hover:bg-gray-500'}
                                            `}
                                        >
                                            {!isStepValid ? (
                                                <span className="text-sm">å°šæœ‰ {missingCount} é¡Œæœªå¡«</span>
                                            ) : currentStep === 6 ? (
                                                isSubmitting ? "é€å‡ºä¸­..." : <>ç¢ºèªé€å‡º <CheckCircle className="ml-2 w-5 h-5" /></>
                                            ) : (
                                                <>ä¸‹ä¸€é  <ArrowRight className="ml-2 w-5 h-5" /></>
                                            )}
                                        </button>
                                    </div>
                                    {!isStepValid && (
                                        <div className="md:hidden flex items-center text-orange-600 text-xs font-bold mt-1 animate-pulse">
                                            â†‘ é»æ“Šè·³è‡³æœªå¡«é¡Œé …
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                        </footer>
                    )}

                    {showAbandonModal && (
                        <div className="fixed inset-0 z-[60] flex items-center justify-center p-4">
                        <div className="absolute inset-0 bg-black/50 backdrop-blur-sm transition-opacity" onClick={() => setShowAbandonModal(false)}></div>
                        <div className="bg-white rounded-2xl p-6 md:p-8 max-w-sm w-full shadow-2xl z-10 transform scale-100 transition-transform">
                            <div className="flex flex-col items-center text-center">
                            <div className="bg-orange-100 p-4 rounded-full mb-4">
                                <HelpCircle className="w-10 h-10 text-orange-500" />
                            </div>
                            <h3 className="text-xl font-bold text-gray-800 mb-2">å¥½ä¸å®¹æ˜“å¡«åˆ°é€™...<br/>æ‚¨ç¢ºå®šä¸ç¹¼çºŒå¡«ç­”å—?</h3>
                            <p className="text-gray-500 text-sm mb-6 leading-relaxed">
                                æ”¾æ£„å¾Œè³‡æ–™å°‡ <span className="font-bold text-red-500">ç„¡æ³•ä¿å­˜</span> å–”ï¼<br/>
                                æ‚¨çš„æ„è¦‹å°æ”¹å–„è­·ç†ç’°å¢ƒéå¸¸é‡è¦ã€‚
                            </p>
                            
                            <div className="flex flex-col gap-3 w-full">
                                <button 
                                onClick={handleContinueSurvey}
                                className="w-full py-3 bg-emerald-600 text-white font-bold rounded-xl shadow-lg hover:bg-emerald-700 hover:scale-[1.02] transition-all flex items-center justify-center"
                                >
                                <ArrowRight className="w-5 h-5 mr-2" /> ç¹¼çºŒå¡«ç­” (æ¨è–¦)
                                </button>
                                <button 
                                onClick={handleConfirmAbandon}
                                className="w-full py-3 border-2 border-gray-300 text-gray-500 font-bold rounded-xl hover:bg-gray-50 hover:text-gray-700 transition-all"
                                >
                                ä¸‹æ¬¡é‡å¡«
                                </button>
                            </div>
                            </div>
                        </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<SurveyForm />);
    </script>
</body>
</html>
